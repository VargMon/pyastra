<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=windows-1251"
 http-equiv="content-type">
  <title>Pyastra ARCHITECTURE</title>
  <meta content="estyler@users.sourceforge.net" name="author">
</head>
<body>
<h1>Pyastra ARCHITECTURE (A bit obsolete)<br>
</h1>
<span style="font-weight: bold;"><br>
Note:</span> current architecture is temporary and may be changed at
any moment!<br>
<br>
<table style="text-align: left; width: 100%; border-collapse: collapse;"
 border="1">
  <tbody>
    <tr>
      <td style="vertical-align: top;">File<br>
      </td>
      <td style="vertical-align: top;">Description<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">pyastra<br>
      </td>
      <td style="vertical-align: top;">Pyastra's console front-end<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">tree2tree.py</td>
      <td style="vertical-align: top;">Tree optimizer<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">tree2asm.py</td>
      <td style="vertical-align: top;">Converter from tree to assembler</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">regs16f877.py<br>
      </td>
      <td style="vertical-align: top;">PIC 16F877 default namespace
(register names, bit names; all in CAPS). Generated by inc2py.py script.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">p16f877.py<br>
      </td>
      <td style="vertical-align: top;">PIC 16F877 specific built-ins.
Is imported by Pyastra in all files (when compiling for this
microcontroller). Includes microcontroller-specific functions like
multiplication, division, power, etc)<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
First standard python module "parser" converts given file to a tree.
Second stage is made by tree2tree.py optimizer. Then it is converted by
tree2asm.py to assembler.<br>
<br>
<h2>More details about tree2asm</h2>
All the commands deal through W register. For example, code <code>a=5</code>
is coded into the following:<br>
<pre>_a      equ     0x37    ;bank -1<br><br>        movlw   0x5<br>        movwf   stack0<br>        movwf   _a<br></pre>
First it reserves memory in bank-independent part (that bank -1 notes),
then it puts the constant in the work register W, then it checks
weather it's zero (see below) and the last thing it puts the value into
the corresponding memory cell.<br>
<br>
When this module needs to check some statements (e. g. for <code>if</code>),
it "runs" the expression and checks the Z bit of STATUS register. For
example, code<br>
<pre>if a:<br>        a=0<br></pre>
will produce the following code:<br>
<pre>        movf    _a,     w<br>        btfsc   STATUS, Z<br>        goto    label0<br>        clrf    _a<br>label0<br></pre>
First line puts the value of register _a into W register (as if we
wrote in that line simply "a" without if). Then it checks Z bit. If
it's cleared, then W register is true (not equals to zero). That means
that the body should be run. Otherwise it jumps to label0. The body is
simple: to clear register a.<br>
<br>
The other statements work in the same manner.<br>
<br>
<h2>About the names and labels</h2>
All the labels generated by Pyastra are generated by the following
template:<br>
<pre>label%i</pre>
where <code>%i</code> is an unique number (decimal integer).<br>
<br>
Other labels are generated when you create a function then it has
"func_" prefix.<br>
<br>
All the user's variable names have "_" prefix don't to interfere with
automatically generated names. <br>
<br>
<h2>More details</h2>
To get more details you may do three things:<br>
<ul>
  <li>Ask me.</li>
  <li>See the sources.</li>
  <li>Try to note what code brings what results<br>
  </li>
</ul>
<br>
<span style="font-style: italic;">To be continued... :)</span><br>
<br>
$Id$<br>
<br>
</body>
</html>
